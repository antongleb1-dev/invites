<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <link rel="icon" type="image/png" href="%VITE_APP_LOGO%" />
    <link rel="apple-touch-icon" href="%VITE_APP_LOGO%" />
    <title>%VITE_APP_TITLE%</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="–°–æ–∑–¥–∞–π—Ç–µ –∫—Ä–∞—Å–∏–≤–æ–µ –æ–Ω–ª–∞–π–Ω-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Å–≤–∞–¥—å–±—É –∑–∞ 2 –º–∏–Ω—É—Ç—ã. RSVP, wishlist, –ø–æ–∂–µ–ª–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π, –ø—Ä–µ–º–∏—É–º —à–∞–±–ª–æ–Ω—ã –∏ –¥–≤—É—è–∑—ã—á–Ω–æ—Å—Ç—å (—Ä—É—Å—Å–∫–∏–π/–∫–∞–∑–∞—Ö—Å–∫–∏–π)." />
    <meta name="keywords" content="—Å–≤–∞–¥—å–±–∞, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Å–≤–∞–¥—å–±—É, –æ–Ω–ª–∞–π–Ω –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, RSVP, wishlist, –∫–∞–∑–∞—Ö—Å–∫–∞—è —Å–≤–∞–¥—å–±–∞, —Ç–æ–π, –∫“Ø–π–µ—É —Ç–æ–π, “õ—ã–∑ “±–∑–∞—Ç—É, –±–µ—Ç–∞—à–∞—Ä" />
    <meta name="author" content="BookMe.kz" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://bookme.kz/" />
    <meta property="og:title" content="%VITE_APP_TITLE% - –°–æ–∑–¥–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Å–≤–∞–¥—å–±—É" />
    <meta property="og:description" content="–ö—Ä–∞—Å–∏–≤—ã–µ —à–∞–±–ª–æ–Ω—ã, RSVP, wishlist, –ø–æ–∂–µ–ª–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π –∏ –¥–≤—É—è–∑—ã—á–Ω–æ—Å—Ç—å ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ." />
    <meta property="og:image" content="%VITE_APP_LOGO%" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://bookme.kz/" />
    <meta property="twitter:title" content="%VITE_APP_TITLE% - –°–æ–∑–¥–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —Å–≤–∞–¥—å–±—É" />
    <meta property="twitter:description" content="–ö—Ä–∞—Å–∏–≤—ã–µ —à–∞–±–ª–æ–Ω—ã, RSVP, wishlist, –ø–æ–∂–µ–ª–∞–Ω–∏—è –≥–æ—Å—Ç–µ–π –∏ –¥–≤—É—è–∑—ã—á–Ω–æ—Å—Ç—å ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ." />
    <meta property="twitter:image" content="%VITE_APP_LOGO%" />
    <!-- Google Fonts for wedding theme -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500;1,600&family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Cinzel:wght@400;500;600;700&family=Great+Vibes&family=Dancing+Script:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700&family=Raleway:wght@400;500;600;700&family=Open+Sans:wght@400;500;600;700&family=Philosopher:ital,wght@0,400;0,700;1,400;1,700&family=Marck+Script&family=Bad+Script&family=Caveat:wght@400;500;600;700&family=Pacifico&family=Amatic+SC:wght@400;700&family=Comfortaa:wght@300;400;500;600;700&family=Jost:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Umami Analytics -->
    <script
      defer
      src="%VITE_ANALYTICS_ENDPOINT%/umami"
      data-website-id="%VITE_ANALYTICS_WEBSITE_ID%"></script>
    
    <!-- Yandex.Metrica counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105574858', 'ym');

        ym(105574858, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/105574858" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrica counter -->
    
    <!-- Smart Form Protection System -->
    <script>
/**
 * –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ React
 * –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
 */
(function() {
  'use strict';
  
  const PROTECTED_FIELDS = [
    '#title', 
    '#titleKz', 
    '#description', 
    '#descriptionKz', 
    '#location', 
    '#locationKz', 
    '#mapUrl', 
    '#slug'
  ];
  
  const protectFormFields = () => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    if (!window.location.pathname.includes('/edit/')) {
      return;
    }
    
    let protectedCount = 0;
    
    PROTECTED_FIELDS.forEach(selector => {
      const field = document.querySelector(selector);
      
      // –ó–∞—â–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –ø–æ–ª—è
      if (field && !field.dataset.protected) {
        setupFieldProtection(field, selector);
        protectedCount++;
      }
    });
    
    if (protectedCount > 0) {
      console.log(`üõ°Ô∏è –ó–∞—â–∏—â–µ–Ω–æ ${protectedCount} –ø–æ–ª–µ–π –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ React`);
    }
  };
  
  const setupFieldProtection = (field, selector) => {
    // –ü–æ–º–µ—á–∞–µ–º –ø–æ–ª–µ –∫–∞–∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ
    field.dataset.protected = 'true';
    
    // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    if (!field.dataset.originalValue) {
      field.dataset.originalValue = field.value;
    }
    
    let userChanged = false;
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const handleUserInput = () => {
      userChanged = true;
      field.dataset.userValue = field.value;
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ sessionStorage –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
      const backupKey = `field-backup-${selector.substring(1)}`;
      sessionStorage.setItem(backupKey, field.value);
      
      console.log(`üìù –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏–ª ${selector.substring(1)}:`, 
        field.value.substring(0, 50) + (field.value.length > 50 ? '...' : ''));
    };
    
    field.addEventListener('input', handleUserInput);
    field.addEventListener('change', handleUserInput);
    
    // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –ø–æ–ø—ã—Ç–∫–∞–º–∏ React –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª–µ
    const observer = new MutationObserver(() => {
      if (userChanged && field.dataset.userValue && field.value !== field.dataset.userValue) {
        console.log(`üõ°Ô∏è –ó–∞—â–∏—â–∞—é –ø–æ–ª–µ ${selector.substring(1)} –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ React`);
        field.value = field.dataset.userValue;
      }
    });
    
    observer.observe(field, { 
      attributes: true, 
      attributeFilter: ['value'] 
    });
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
    const protectionInterval = setInterval(() => {
      if (userChanged && field.dataset.userValue && field.value !== field.dataset.userValue) {
        field.value = field.dataset.userValue;
      }
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª–µ–Ω –∏–∑ DOM
      if (!document.contains(field)) {
        clearInterval(protectionInterval);
        observer.disconnect();
      }
    }, 100);
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ sessionStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    const backupKey = `field-backup-${selector.substring(1)}`;
    const savedValue = sessionStorage.getItem(backupKey);
    if (savedValue && savedValue !== field.value) {
      field.value = savedValue;
      field.dataset.userValue = savedValue;
      userChanged = true;
      console.log(`üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è ${selector.substring(1)} –∏–∑ backup`);
    }
  };
  
  // –û—á–∏—Å—Ç–∫–∞ backup –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã
  const clearBackupOnSave = () => {
    const saveButton = document.querySelector('button[type="submit"]');
    if (saveButton) {
      saveButton.addEventListener('click', () => {
        // –û—á–∏—â–∞–µ–º backup —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è (–≤—Ä–µ–º—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É)
        setTimeout(() => {
          PROTECTED_FIELDS.forEach(selector => {
            const backupKey = `field-backup-${selector.substring(1)}`;
            sessionStorage.removeItem(backupKey);
          });
          console.log('üßπ –û—á–∏—â–µ–Ω backup –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã');
        }, 3000);
      });
    }
  };
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã
  const initProtectionSystem = () => {
    protectFormFields();
    clearBackupOnSave();
  };
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞—â–∏—Ç—É –∫–æ–≥–¥–∞ DOM –≥–æ—Ç–æ–≤
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProtectionSystem);
  } else {
    initProtectionSystem();
  }
  
  // –ü–µ—Ä–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∑–∞—â–∏—Ç—É –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (–¥–ª—è SPA)
  let lastPathname = window.location.pathname;
  const navigationWatcher = setInterval(() => {
    if (window.location.pathname !== lastPathname) {
      lastPathname = window.location.pathname;
      setTimeout(initProtectionSystem, 500);
    }
  }, 100);
  
  // –ó–∞—â–∏—â–∞–µ–º –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫
  document.addEventListener('visibilitychange', () => {
    if (!document.hidden && window.location.pathname.includes('/edit/')) {
      setTimeout(initProtectionSystem, 100);
    }
  });
  
  // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  console.log('üöÄ –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
  
  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–≤–Ω–µ
  window.FormProtection = {
    protect: protectFormFields,
    init: initProtectionSystem,
    fields: PROTECTED_FIELDS
  };
  
})();
    </script>
  </body>

</html>